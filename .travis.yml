language: node_js
dist: trusty
sudo: true
node_js:
- 7.5.0
addons:
  apt:
    packages:
    - python-pip
notifications:
  email: false
  slack:
    rooms:
    - gapminder:siB4Z9ymsYR6qHnRPpgUoB2Q#vizabi-spam
    on_success: change
    on_failure: always
cache:
  directories:
  - node_modules
before_install:
- npm install -g npm@latest
- sudo pip install s3cmd
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm run build
script:
- npm run deploy
deploy:
  skip_cleanup: true
  provider: npm
  email: kgrpwnz@gmail.com
  api_key:
    secure: lxA/sn2a/11KUrUW4Jr0jdlh5+yfXm1IvJ0x8h3kwVV2VXyGjz8DvGbPOQ2ThV10LJYM1CtiBKOzpDsrWiqFsd8B9dqBLf1Yc6Y5ROFZRkWvpPyHid4rPOvlLZ30ViOG0dd/p8yPPq/hA96uNhpqlLTZSIxzrc7S2gFPU0XO3Xv1WUIH/EhNEE4HlQ0ZF+JXub2KCI33dELl6jdK0+Dh2YkXAxuN2qXruMSlAu3ojpgQVmhZsOMWP+N8xSVgwP2kSeIRIFc50GMc7V3wAvyJ63W3LznMMn697bKqIrYXpgN2eqXTWlo4Q9dJosheED2kUl+nMszjt0aZq3iCusYviMVzLodIiOFamN8kggpAjUOT25HFaJfPdEdLItwST/tFx2C/eVKRWt5YzQiDviO22fXeC7/pnoBgMCYCZ+bfoVhA/IkXf6rnuc9Mi6GvUx++rd1DTVa4WJP9U2KR1xra9HNc5RvBmXQiXJg06NVkuUSGsWq4j5ZlrnmAa8SCRB3Rtylc9uviiSGrRzprmbdFUA3FnojxWXt8HIVQbeJAQORXiieiw0vDfweVjlqRRXilC4zgbTUkVhJ4KEx1SSQ7bjPEFtsqEjNZqjWlDOnALzsQj+k96saMAzvyrQeZK3qr7ocJDvyNtRHdz28iT1Za+cgQU25p4AYuOvU3+Jfbgak=
  on:
    branch: develop
    node: 7.5.0
    condition: "-e /tmp/deployment.flag"
